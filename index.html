<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>English Placement Test</title>
  
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome -->
  <script src="https://kit.fontawesome.com/yourfontawesomekey.js" crossorigin="anonymous"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
    .dark {
      background-color: #111827;
      color: #f9fafb;
    }
    .light {
      background-color: #ffffff;
      color: #111827;
    }
    [data-theme="dark"] .card {
      background-color: #1f2937;
    }
    [data-theme="light"] .card {
      background-color: #f8fafc;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="p-4 flex justify-between items-center border-b">
    <h1 class="text-2xl font-bold"><i class="fas fa-language"></i> English Test</h1>
    <button id="themeToggle" class="btn btn-outline-primary">
      <i class="fas fa-sun"></i> Toggle Theme
    </button>
  </header>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto p-4" id="app">
    <!-- Dynamic content here -->
  </main>

  <!-- Footer -->
  <footer class="text-center p-4 border-t">
    © 2025 English Placement Test App
  </footer>

<script>
// Preguntas JSON
const questions = [
  { 
    type: 'text',
    question: 'What is the capital of England?',
    options: ['Paris', 'London', 'Madrid', 'Berlin'],
    answer: 'London'
  },
  { 
    type: 'image',
    question: 'Identify this object',
    src: 'https://via.placeholder.com/150',
    options: ['Dog', 'Cat', 'Bird', 'Fish'],
    answer: 'Cat'
  },
  { 
    type: 'audio',
    question: 'What word is spoken?',
    src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
    options: ['Hello', 'Goodbye', 'Thanks', 'Morning'],
    answer: 'Hello'
  },
  // Agrega más preguntas aquí... (tendrás que tener 50 en total)
];

// Variables
let currentQuestion = 0;
let score = 0;
let timer;
let countdown = 60 * 60; // 60 minutes

// Funciones principales
function renderQuestion() {
  const q = questions[currentQuestion];
  const app = document.getElementById('app');
  let content = `<div class="card p-4">`;
  content += `<div class="flex justify-between mb-2"><span>Question ${currentQuestion + 1}/${questions.length}</span><span id="timer" class="font-bold text-red-500"></span></div>`;
  content += `<h2 class="text-xl mb-4">${q.question}</h2>`;

  if (q.type === 'image') {
    content += `<img src="${q.src}" alt="Question Image" loading="lazy" class="mb-4 mx-auto" style="max-height:200px;">`;
  }
  if (q.type === 'audio') {
    content += `<audio controls class="mb-4 mx-auto"><source src="${q.src}" type="audio/mpeg">Your browser does not support the audio element.</audio>`;
  }

  content += `<form id="questionForm" class="flex flex-col gap-2">`;
  q.options.forEach(option => {
    content += `
      <label class="btn btn-outline-secondary">
        <input type="radio" name="answer" value="${option}" required> ${option}
      </label>`;
  });
  content += `</form>`;
  content += `<button onclick="submitAnswer()" class="btn btn-primary mt-4"><i class="fas fa-arrow-right"></i> Next</button>`;
  content += `</div>`;
  app.innerHTML = content;
  updateTimer();
}

function submitAnswer() {
  const form = document.getElementById('questionForm');
  const selected = form.answer?.value || '';
  if (selected === questions[currentQuestion].answer) {
    score++;
  }
  currentQuestion++;
  if (currentQuestion < questions.length) {
    renderQuestion();
  } else {
    showForm();
  }
}

function showForm() {
  const app = document.getElementById('app');
  app.innerHTML = `
    <div class="card p-6">
      <h2 class="text-2xl mb-4"><i class="fas fa-user"></i> Enter your details</h2>
      <form id="userForm" class="flex flex-col gap-4">
        <input type="text" id="name" placeholder="Full Name" required class="input input-bordered">
        <input type="email" id="email" placeholder="Email" required class="input input-bordered">
        <button type="submit" class="btn btn-success"><i class="fas fa-paper-plane"></i> Submit Results</button>
      </form>
    </div>
  `;
  document.getElementById('userForm').addEventListener('submit', sendResults);
}

function sendResults(e) {
  e.preventDefault();
  const name = document.getElementById('name').value;
  const email = document.getElementById('email').value;
  const level = determineLevel(score);
  localStorage.setItem('englishTestResults', JSON.stringify({ name, email, score, level }));
  showResults(name, email, score, level);
}

function determineLevel(score) {
  if (score <= 5) return "A1.1";
  if (score <= 10) return "A1.2";
  if (score <= 15) return "A1.3";
  if (score <= 20) return "B1.1";
  if (score <= 25) return "B1.2";
  if (score <= 30) return "B1.3";
  if (score <= 35) return "C1.1";
  if (score <= 40) return "C1.2";
  if (score <= 45) return "C1.3";
  return "D1.1";
}

function showResults(name, email, score, level) {
  const app = document.getElementById('app');
  app.innerHTML = `
    <div class="card p-6 space-y-6">
      <h2 class="text-2xl"><i class="fas fa-trophy"></i> Congratulations, ${name}!</h2>
      <table class="table">
        <tr><th>Correct</th><td>${score}</td></tr>
        <tr><th>Incorrect</th><td>${questions.length - score}</td></tr>
        <tr><th>Level</th><td>${level}</td></tr>
      </table>
      <canvas id="resultChart" width="300" height="300" class="mx-auto"></canvas>
      <div class="flex justify-center gap-4">
        <button onclick="downloadCSV()" class="btn btn-outline-primary"><i class="fas fa-download"></i> Download CSV</button>
        <button onclick="downloadChart()" class="btn btn-outline-success"><i class="fas fa-image"></i> Download PNG</button>
      </div>
    </div>
  `;

  // Chart
  const ctx = document.getElementById('resultChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Correct', 'Incorrect'],
      datasets: [{
        data: [score, questions.length - score],
        backgroundColor: ['#4ade80', '#f87171']
      }]
    },
    options: {
      animation: {
        animateScale: true
      }
    }
  });

  gsap.from('#resultChart', { opacity: 0, y: 50, duration: 1 });
}

function updateTimer() {
  const timerDisplay = document.getElementById('timer');
  const minutes = Math.floor(countdown / 60);
  const seconds = countdown % 60;
  timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
  if (countdown > 0) {
    countdown--;
    timer = setTimeout(updateTimer, 1000);
  } else {
    alert('Time is up!');
    showForm();
  }
}

function downloadCSV() {
  const results = JSON.parse(localStorage.getItem('englishTestResults'));
  const csv = `Name,Email,Score,Level\n${results.name},${results.email},${results.score},${results.level}`;
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'results.csv';
  a.click();
  URL.revokeObjectURL(url);
}

function downloadChart() {
  const canvas = document.getElementById('resultChart');
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = url;
  a.download = 'chart.png';
  a.click();
}

document.getElementById('themeToggle').addEventListener('click', () => {
  const html = document.documentElement;
  if (html.getAttribute('data-theme') === 'light') {
    html.setAttribute('data-theme', 'dark');
  } else {
    html.setAttribute('data-theme', 'light');
  }
});

// Inicializar
renderQuestion();

</script>
</body>
</html>
